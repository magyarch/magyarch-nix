#!/usr/bin/env bash
# Vifm image preview using ueberzugpp

img="$5"

if ! command -v ueberzugpp &>/dev/null; then
    exit 1
fi

# Kill existing previews
pkill -f "ueberzugpp layer" 2>/dev/null

# Start new ueberzugpp instance
ueberzugpp layer --parser bash &
sleep 0.05

# Get terminal size parameters from vifm
X=$1
Y=$2
W=$3
H=$4

{
  echo "add [identifier]=\"preview\" \
       [x]=\"$X\" [y]=\"$Y\" [width]=\"$W\" [height]=\"$H\" \
       [path]=\"$img\""
} | ueberzugpp layer --parser bash
